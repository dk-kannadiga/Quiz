<!DOCTYPE html>
<html lang="kn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kannada Quiz</title>
<style>
  body { font-family: 'Noto Sans Kannada', sans-serif; background: #fafafa; margin: 0; padding: 0; }
  .page { display: none; padding: 20px; }
  .active { display: block; }
  .btn { background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 10px; }
  .btn:hover { background: #1565c0; }
</style>
</head>
<body>

<!-- Registration Page -->
<div id="registerPage" class="page active">
  <h2>ಪ್ರಾರಂಭಿಸಿ</h2>
  <input id="name" placeholder="ಹೆಸರು" required><br>
  <input id="email" placeholder="ಇಮೇಲ್" required><br>
  <input id="phone" placeholder="ಫೋನ್" required><br>
  <button class="btn" onclick="startQuiz()">ಆರಂಭಿಸು</button>
</div>

<!-- Quiz Page -->
<div id="quizPage" class="page">
  <h2 id="questionText"></h2>
  <div id="options"></div>
  <button class="btn" onclick="nextQuestion()">ಮುಂದೆ</button>
</div>

<!-- Result Page -->
<div id="resultPage" class="page">
  <h2>ನಿಮ್ಮ ಅಂಕಗಳು: <span id="score"></span></h2>
</div>

<script>
  const quizConfig = {
    current: 0,
    score: 0,
    questions: []
  };

  const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_URL_HERE/exec"; // <-- Replace with your deployed script URL

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  async function startQuiz() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();
    if (!name || !email || !phone) return alert("ದಯವಿಟ್ಟು ಎಲ್ಲಾ ವಿವರಗಳನ್ನು ತುಂಬಿ.");

    quizConfig.user = { name, email, phone };
    await loadQuestionsFromSheet();
  }

  async function loadQuestionsFromSheet() {
    try {
      const response = await fetch(scriptURL);
      const data = await response.json();
      quizConfig.questions = data;
      quizConfig.current = 0;
      quizConfig.score = 0;
      showQuestion();
      showPage('quizPage');
    } catch (err) {
      console.error("Error loading questions:", err);
      alert("ಪ್ರಶ್ನೆಗಳನ್ನು ಲೋಡ್ ಮಾಡಲು ಸಾಧ್ಯವಾಗಲಿಲ್ಲ. ಮತ್ತೆ ಪ್ರಯತ್ನಿಸಿ.");
    }
  }

  function showQuestion() {
    const q = quizConfig.questions[quizConfig.current];
    if (!q) return showResults();

    document.getElementById("questionText").innerText = q.question;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";

    q.options.forEach((opt, i) => {
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.textContent = opt;
      btn.onclick = () => selectAnswer(i);
      optionsDiv.appendChild(btn);
    });
  }

  function selectAnswer(index) {
    const currentQ = quizConfig.questions[quizConfig.current];
    if (index === currentQ.correct) quizConfig.score++;
    nextQuestion();
  }

  function nextQuestion() {
    quizConfig.current++;
    if (quizConfig.current < quizConfig.questions.length) {
      showQuestion();
    } else {
      showResults();
    }
  }

  function showResults() {
    document.getElementById("score").innerText = `${quizConfig.score} / ${quizConfig.questions.length}`;
    showPage('resultPage');
    saveResult();
  }

  async function saveResult() {
    const payload = {
      timestamp: new Date().toLocaleString(),
      ...quizConfig.user,
      answers: quizConfig.questions.map((q, i) => ({
        question: i,
        answer: q.selected || 'skipped'
      })),
      score: quizConfig.score,
      completedAt: new Date().toISOString()
    };

    try {
      await fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: { 'Content-Type': 'application/json' }
      });
    } catch (err) {
      console.error("Error saving result:", err);
    }
  }
</script>

</body>
</html>
