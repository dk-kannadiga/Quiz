<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Knowledge Challenge Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-800 min-h-screen text-white">
  <!-- Registration Screen -->
  <div id="welcomeScreen" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl max-w-lg w-full p-8 fade-in">
      <h1 class="text-3xl font-bold mb-4" id="welcomeTitle">🧠 Knowledge Challenge Quiz</h1>
      <form id="registrationForm" class="space-y-4">
        <input type="text" id="name" placeholder="Full Name" required class="w-full p-3 rounded text-black" />
        <input type="email" id="email" placeholder="Email" required class="w-full p-3 rounded text-black" />
        <input type="tel" id="phone" placeholder="Phone Number" required class="w-full p-3 rounded text-black" />
        <input type="text" id="postal" placeholder="Postal Address" class="w-full p-3 rounded text-black hidden" />
        <div class="bg-white/5 p-3 rounded text-sm">
          <label><input type="checkbox" id="terms" required> I agree to the Terms & Conditions</label>
        </div>
        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 p-3 rounded font-bold">Start Quiz 🚀</button>
      </form>
    </div>
  </div>

  <!-- Quiz Screen -->
  <div id="quizScreen" class="hidden min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl max-w-3xl w-full p-8">
      <div class="flex justify-between items-center mb-6">
        <div>Question <span id="currentQuestionNum">1</span> of <span id="totalQuestions">0</span></div>
        <div id="timerDisplay" class="bg-red-500 px-4 py-2 rounded-full font-bold">⏰ <span id="timeLeft">10</span>s</div>
      </div>
      <h3 id="questionText" class="text-2xl font-bold mb-6">Loading question...</h3>
      <div id="optionsContainer" class="space-y-4"></div>
      <div class="flex justify-between mt-6">
        <button onclick="skipQuestion()" class="bg-gray-500 px-6 py-3 rounded">Skip ⏭️</button>
        <button onclick="submitAnswer()" class="bg-green-500 px-8 py-3 rounded">Submit ✅</button>
      </div>
    </div>
  </div>

  <!-- Thank You Screen -->
  <div id="thankYouScreen" class="hidden min-h-screen flex items-center justify-center p-4">
    <div class="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl max-w-lg w-full p-8 text-center">
      <h2 class="text-3xl font-bold mb-4">🎉 Thank You for Participating!</h2>
      <p>Your answers will be reviewed and you will receive your e-certificate on <span id="certificateDate"></span>.</p>
    </div>
  </div>

<script>
const GOOGLE_SHEET_URL = "YOUR_WEB_APP_URL";
let quizData = {};
let currentQuestion = 0, selectedAnswer = null, timer = null, timeLeft = 0, answers = [], userDetails = {};

document.getElementById('registrationForm').addEventListener('submit', e => {
  e.preventDefault();
  userDetails.name = document.getElementById('name').value;
  userDetails.email = document.getElementById('email').value;
  userDetails.phone = document.getElementById('phone').value;
  if (quizData.postalRequired) userDetails.postalAddress = document.getElementById('postal').value;
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('quizScreen').classList.remove('hidden');
  loadQuestion();
  startTimer();
});

function loadQuestion() {
  const q = quizData.questions[currentQuestion];
  document.getElementById('currentQuestionNum').textContent = currentQuestion + 1;
  document.getElementById('totalQuestions').textContent = quizData.questions.length;
  document.getElementById('questionText').textContent = q.question;
  const container = document.getElementById('optionsContainer');
  container.innerHTML = "";
  q.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.textContent = opt;
    btn.className = "block w-full bg-white text-black p-2 rounded";
    btn.onclick = () => { selectedAnswer = i; [...container.children].forEach(c => c.classList.remove("bg-blue-300")); btn.classList.add("bg-blue-300"); };
    container.appendChild(btn);
  });
}

function startTimer() {
  clearInterval(timer);
  timeLeft = quizData.timer;
  document.getElementById('timeLeft').textContent = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById('timeLeft').textContent = timeLeft;
    if (timeLeft <= 0) { clearInterval(timer); skipQuestion(); }
  }, 1000);
}

function submitAnswer() {
  if (selectedAnswer === null) return;
  const correct = quizData.questions[currentQuestion].correct === selectedAnswer;
  answers.push({ selectedAnswer, correct });
  nextQuestion();
}

function skipQuestion() { answers.push({ selectedAnswer: null, correct: false }); nextQuestion(); }

function nextQuestion() {
  clearInterval(timer);
  currentQuestion++;
  if (currentQuestion >= quizData.questions.length) {
    document.getElementById('quizScreen').classList.add('hidden');
    document.getElementById('thankYouScreen').classList.remove('hidden');
    document.getElementById('certificateDate').textContent = quizData.quizEndDate;
    submitToGoogleSheets();
  } else { loadQuestion(); startTimer(); }
}

function submitToGoogleSheets() {
  fetch(GOOGLE_SHEET_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      ...userDetails,
      score: answers.filter(a => a.correct).length,
      total: quizData.questions.length,
      answers: answers.map((a, i) => ({
        selectedOption: a.selectedAnswer !== null ? quizData.questions[i].options[a.selectedAnswer] : 'Skipped',
        correct: a.correct
      }))
    })
  });
}

fetch(GOOGLE_SHEET_URL)
  .then(r => r.json())
  .then(data => {
    quizData = data;
    if (quizData.postalRequired) document.getElementById('postal').classList.remove('hidden');
    document.getElementById('welcomeTitle').textContent = "🧠 " + quizData.title;
  });
</script>
</body>
</html>
